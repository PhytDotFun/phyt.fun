services:
    postgres:
        image: postgres:17
        container_name: ${COMPOSE_PROJECT_NAME:-phyt}-postgres
        environment:
            POSTGRES_USER: phyt_user
            POSTGRES_PASSWORD: phyt_password
            POSTGRES_DB: phyt_db
        ports:
            - 5432:5432
        volumes:
            - phyt-postgres-data:/var/lib/postgresql/data
        healthcheck:
            test: ['CMD-SHELL', 'pg_isready -U phyt_user -d phyt_db']
            interval: 5s
            timeout: 5s
            retries: 5

    redis:
        image: redis:7-alpine
        container_name: ${COMPOSE_PROJECT_NAME:-phyt}-redis
        ports:
            - 6379:6379
        volumes:
            - phyt-redis-data:/data
        healthcheck:
            test: ['CMD', 'redis-cli', 'ping']
            interval: 5s
            timeout: 5s
            retries: 5

volumes:
    phyt-postgres-data:
        name: ${COMPOSE_PROJECT_NAME:-phyt}-postgres-data
    phyt-redis-data:
        name: ${COMPOSE_PROJECT_NAME:-phyt}-redis-data
